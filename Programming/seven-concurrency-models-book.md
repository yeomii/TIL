# 7가지 동시성 모델

* http://m.hanbit.co.kr/store/books/book_view.html?p_code=B3745244799

# 01 서문

## 동시성과 병렬성
```
동시성은 여러 일을 한꺼번에 다루는 데 관한 것이다
병렬성은 여러 일을 한꺼번에 실행하는 데 관한 것이다
- Rob Pike
```

* 동시성과 병렬성이 혼동되는 이유는 정통적으로 사용하는 스레드와 잠금장치는 병렬성을 직접 지원하지 않기 때문이다.
* 이러한 스레드와 잠금장치를 이용해서 멀티코어를 활용하는 유일한 방법은 동시적인 프로그램을 작성해 병렬로 동작하는 하드웨어에서 실행하는 것이다.

## 병렬 아키텍처
* 비트 수준 병렬성
* 명령어 수준 병렬성
    * cpu 파이프라이닝, 비순차 실행, 추측 실행
* 데이터 병렬성 
    * SIMD
* 태스크 수준 병렬성
    * 메모리 모델
    * 공유 메모리 / 분산 메모리

## 일곱가지 모델
* 스레드와 잠금장치
    * 문제점이 많지만 다양한 기술의 기반이 되는 기본 기술
* 함수형 프로그래밍
    * 스레드 안전을 보장하여 병렬처리가 쉽다
* 클로저 방식 - 아이덴티티와 상태 분리하기
    * 클로저는 명령형과 함수형 프로그래밍을 효과적으로 결합
* 액터
    * 범용의 동시성 프로그래밍 모델
    * 공유 메모리와 분산 메모리 아키텍처 양측에서 활용가능
    * 지리적 분산을 적극 지원하고, 장애 허용과 탄력성에 대한 지원이 강함
* 순차 프로세스 통신 (Communicating sequential processes)
    * 액터 모델과 공통점이 많아보이지만 전혀 다른 특징을 가짐
    * 커뮤니케이션을 위해 액터같은 객체가 아닌 채널이라는 개념을 사용
* 데이터 병렬성
    * GPU 와 같은 경우
* 람다 아키텍처
    * 맵리듀스와 스트리밍 프로세스의 장점을 결합, 다양한 빅데이터 문제 해결

## 알맞은 모델을 고를 때 고려할 점
* 이 모델은 동시성 문제, 병렬성 문제, 혹은 두 개를 모두 해결하는 데 적합한가?
* 이 모델은 어떤 병렬 아키텍처를 타깃으로 삼고 있는가?
* 이 모델은 탄력성을 갖춘 코드, 혹은 지리적으로 분산된 코드를 작성할 때 필요한 도구를 제공하는가?

# 02 스레드와 잠금장치

* 스레드와 잠금장치는 하드웨어 동작방식을 거의 그대로 옮긴것과 비슷하다.
* 장점
    * 단순해서 대부분의 언어가 이 기능을 제공
* 단점
    * 너무 단순해서 안전한 코드를 작성하는데 도움을 주지도 않고, 유지보수하기도 어렵다

## 상호 배제와 메모리 모델
* 스레드 
    - 자바에서 사용하는 동시성의 가장 기본 단위, 하나의 논리적 흐름
    - 공유 메모리를 이용해서 다른 스레드와 의사소통함

* 스레드 생성 기본 예제
```kotlin
fun main(args: Array<String>) {
    val myThread = Thread{
        println("${Thread.currentThread().name} - hello from new thread")
    }

    myThread.start()
    Thread.yield()
    println("${Thread.currentThread().name} - hello from main")
    myThread.join()
}
```
* `join` 메서드는 해당 스레드가 동작을 멈출때까지 기다린다.
* `Thread.yield` 는 현재 실행 중인 스레드가 사용 중인 프로세서를 양보할 용의가 있음을 스케줄러에 알려주는 힌트이다.
    * 때문에 위 코드는 실행 순서가 항상 보장되지 않는다.
    * `Thread.yield` 를 주석처리 해도 실행 순서가 보장되지는 않는다.


